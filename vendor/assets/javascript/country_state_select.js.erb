function CountryStateSelect(options) {

  var state_id = options['state_id'];
  var country_id = options['country_id'];

  var state_name = $('#' + state_id).attr('name');
  var state_class = $('#' + state_id).attr('class');

  return statesDropdown();

  // ====== ***** METHODS ***** ===================================================================== //

  function statesDropdown() {

    addChosenToCountry();
    addChosenToState();

    $("#" + country_id).change(function () {
      return findStates($(this).val());
    });
  }

  function addChosenToState(){
    if (chosenIsRequired && stateIsNotText()) {
      $('#' + state_id).chosen();
    }
  }

  function stateIsNotText(){
    return !$('#' + state_id).is("[type=text]");
  }

  function addChosenToCountry(){
    if (chosenIsRequired) {
      $('#' + country_id).chosen();
    }
  }

  function removeChosenFromFields(){
    if (chosenIsRequired) {
      $("#" + options['state_id'] + "_chosen").remove();
    }
  }

  function chosenIsRequired(){
    return options.hasOwnProperty("chosen_ui") && options['chosen_ui'];
  }

  function findStates(id) {

    //Remove all Chosen from existing fields
    removeChosenFromFields();

    //Perform AJAX request to get the data; on success, build the dropdown
    $.ajax({
      url: "/find_states",
      type: 'post',
      dataType: 'json',
      cache: false,
      data: {country_id: id},
      success: function (data) { buildStatesDropdown(data.cscs) }
    });
  }

  //Build the HTML for our dropdown menus
  function buildStatesDropdown(data) {

    if (data.length === 0) {
      html = '<input id="' + state_id + '" name="' + state_name + '" class="' + state_class + '" type="text"  type="text" value="" >';
    } else {
      html = '<select id="' + state_id + '" name="' + state_name + '" class="' + state_class + '" >';

      for (i = 0; i < data.length; i++) {
        html += '<option>' + data[i][1] + '</option>';
      }

      html += '</select>';
    }

    $('#' + state_id).replaceWith(html);

    //This has to happen AFTER we've replaced the dropdown or text
    if (data.length > 0) {
      addChosenToState();
    }

  }

}
